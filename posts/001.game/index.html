<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的部落格</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1 id="title">我的部落格</h1>
    <nav>
      <a href="#gallery">作品展示</a>
      <a href="#blog">文章</a>
      <a href="#contact">聯絡</a>
    </nav>
  </header>

  <main>
    <section id="blog">
      <h2>最新文章</h2>
      <div id="blog-list"></div>
    </section>

    <section id="contact">
      <h2>聯絡資訊</h2>
      <ul class="contact-list">
        <li>Email: <a href="mailto:baiyanchen8@gamil.com">baiyanchen8@gamil.com</a></li>
        <li>GitHub: <a href="https://github.com/baiyanchen8" target="_blank">baiyanchen8</a></li>
        <li>HackMD: <a href="https://hackmd.io/@baiyanchen8" target="_blank">baiyanchen8 的 HackMD</a></li>
      </ul>
      
    </section>
    <footer>
    <p><a href="/index.html">回首頁</a></p>
    </footer>
  </main>

  <script>
    // 格式化主題名稱
    function formatThemeName(theme) {
      return theme
        .replace(/^\d+[._-]*/, '') // 移除開頭編號
        .split(/[._-]/) // 分割不同單字
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    }

    // 設置頁面標題
    function setDocumentTitle() {
      const currentPath = window.location.pathname;
      const themePattern = /\/posts\/([^/]+)\/index\.html$/i;
      const match = currentPath.match(themePattern);

      let titleText = '我的部落格';
      let pageTitle = '我的部落格';

      if (match && match[1]) {
        const theme = match[1];
        titleText = formatThemeName(theme);
        pageTitle = `${titleText} | ${pageTitle}`;
      } else {
        // 處理非文章頁的標題
        const pathSegments = currentPath.split('/');
        const fileName = pathSegments.pop() || '';
        const baseName = fileName.replace(/(^\d+[._-]*)|(\.html$)/gi, '');

        if (baseName && baseName !== 'index') {
          titleText = formatThemeName(baseName);
          pageTitle = `${titleText} | ${pageTitle}`;
        }
      }

      document.title = pageTitle;
      document.getElementById('title').textContent = titleText;
    }

    // 顯示錯誤訊息
    function displayError(message) {
      const blogList = document.getElementById('blog-list');
      blogList.innerHTML = `<p class="error">${message}</p>`;
    }

    // 創建文章元素
    function createPostElement(post) {
      const li = document.createElement('li');
      const article = document.createElement('article');

      const title = document.createElement('h3');
      const link = document.createElement('a');
      link.classList.add('post-link');
      link.href = post.path;
      link.textContent = post.title;

      const meta = document.createElement('div');
      meta.classList.add('post-meta');
      meta.innerHTML = `
        <time>${post.created_at}</time>
        <span class="update-time">最後更新: ${post.updated_at}</span>
      `;

      title.appendChild(link);
      article.appendChild(title);
      article.appendChild(meta);
      li.appendChild(article);
      return li;
    }

    // 渲染文章列表
    function renderPosts(data) {
      const blogList = document.getElementById('blog-list');
      const categories = Object.keys(data.posts).sort();

      categories.forEach(category => {
        const section = document.createElement('section');
        section.classList.add('category-section');

        const heading = document.createElement('h3');
        heading.textContent = category;

        const postList = document.createElement('ul');
        postList.classList.add('post-list');

        data.posts[category]
          .filter(post => !post.title.match(/index/i))
          .forEach(post => {
            postList.appendChild(createPostElement(post));
          });

        section.appendChild(heading);
        section.appendChild(postList);
        blogList.appendChild(section);
      });
    }

    // 初始化加載
    window.addEventListener('DOMContentLoaded', () => {
      setDocumentTitle();

      fetch('/asserts/file-list.json')
        .then(response => {
          if (!response.ok) throw new Error(`HTTP錯誤! 狀態碼: ${response.status}`);
          return response.json();
        })
        .then(renderPosts)
        .catch(error => {
          console.error('資料獲取失敗:', error);
          displayError('無法載入文章列表，請稍後再試或聯繫管理員');
        });
    });
  </script>
</body>
</html>